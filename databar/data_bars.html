document.addEventListener('DOMContentLoaded', function() {
  const data = [
    { label: 'HTML', value: 52.2, color: 'blue' },
    { label: 'CSS', value: 45.9, color: 'green' },
    { label: 'JavaScript', value: 1.7, color: 'red' },
    { label: 'Ruby', value: 0.2, color: 'purple' }
  ];

  const barsContainer = document.getElementById('bars');

  data.forEach(item => {
    const barWrap = document.createElement('div');
    barWrap.className = 'bar-wrap';

    const label = document.createElement('label');
    label.textContent = item.label;

    const bar = document.createElement('div');
    bar.className = `bar ${item.color}`;
    bar.setAttribute('data-percentage', item.value);
    bar.style.width = item.value + '%';

    barWrap.appendChild(label);
    barWrap.appendChild(bar);
    barsContainer.appendChild(barWrap);
  });

  document.querySelectorAll('.bar').forEach(drawElement);
  document.querySelectorAll('.measure').forEach(drawElement);
  
  document.querySelectorAll('a.redraw').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      document.querySelectorAll('.bar').forEach(randomiseElement);
      document.querySelectorAll('.measure').forEach(randomiseElement);
    });
  });

  function drawElement(elem) {
    let percentage = parseInt(elem.dataset.percentage, 10);
    if (isNaN(percentage)) return;
    percentage = Math.min(100, percentage);
    elem.style.width = percentage + '%';
  }

  function randomiseElement(elem) {
    const width = Math.floor(Math.random() * (100 - 20 + 1)) + 20;
    elem.style.width = width + '%';
    elem.dataset.percentage = width;
  }
});
